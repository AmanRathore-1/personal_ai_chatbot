{"version":3,"sources":["../../src/react/use-resource.ts"],"sourcesContent":["import { useEffect, useLayoutEffect, useMemo, useState } from \"react\";\nimport { ResourceElement } from \"../core/types\";\nimport { getResourceFn } from \"../core/getResourceFn\";\nimport {\n  createResourceFiber,\n  unmountResource,\n  renderResource,\n  commitResource,\n} from \"../core/ResourceFiber\";\n\nconst shouldAvoidLayoutEffect =\n  (globalThis as any).__ASSISTANT_UI_DISABLE_LAYOUT_EFFECT__ === true;\n\nconst useIsomorphicLayoutEffect = shouldAvoidLayoutEffect\n  ? useEffect\n  : useLayoutEffect;\n\nexport function useResource<R, P>(element: ResourceElement<R, P>): R {\n  const [, rerender] = useState({});\n  const fiber = useMemo(\n    () => createResourceFiber(getResourceFn(element.type), () => rerender({})),\n    [element.type, rerender],\n  );\n\n  const result = renderResource(fiber, element.props);\n  useIsomorphicLayoutEffect(() => {\n    return () => unmountResource(fiber);\n  }, []);\n  useIsomorphicLayoutEffect(() => {\n    commitResource(fiber, result);\n  });\n\n  return result.state;\n}\n"],"mappings":";AAAA,SAAS,WAAW,iBAAiB,SAAS,gBAAgB;AAE9D,SAAS,qBAAqB;AAC9B;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AAEP,IAAM,0BACH,WAAmB,2CAA2C;AAEjE,IAAM,4BAA4B,0BAC9B,YACA;AAEG,SAAS,YAAkB,SAAmC;AACnE,QAAM,CAAC,EAAE,QAAQ,IAAI,SAAS,CAAC,CAAC;AAChC,QAAM,QAAQ;AAAA,IACZ,MAAM,oBAAoB,cAAc,QAAQ,IAAI,GAAG,MAAM,SAAS,CAAC,CAAC,CAAC;AAAA,IACzE,CAAC,QAAQ,MAAM,QAAQ;AAAA,EACzB;AAEA,QAAM,SAAS,eAAe,OAAO,QAAQ,KAAK;AAClD,4BAA0B,MAAM;AAC9B,WAAO,MAAM,gBAAgB,KAAK;AAAA,EACpC,GAAG,CAAC,CAAC;AACL,4BAA0B,MAAM;AAC9B,mBAAe,OAAO,MAAM;AAAA,EAC9B,CAAC;AAED,SAAO,OAAO;AAChB;","names":[]}