{"version":3,"sources":["../../src/client/Tools.ts"],"sourcesContent":["import { resource, tapState, tapEffect } from \"@assistant-ui/tap\";\nimport { tapApi } from \"../utils/tap-store\";\nimport { tapModelContext } from \"./ModelContext\";\nimport { ToolsState, ToolsApi } from \"./types/Tools\";\nimport type { Tool } from \"assistant-stream\";\nimport { type Toolkit } from \"../model-context/toolbox\";\n\nexport const Tools = resource(({ toolkit }: { toolkit?: Toolkit }) => {\n  const [state, setState] = tapState<ToolsState>(() => ({\n    tools: {},\n  }));\n\n  const modelContext = tapModelContext();\n\n  tapEffect(() => {\n    if (!toolkit) return;\n    const unsubscribes: (() => void)[] = [];\n\n    // Register tool UIs (exclude symbols)\n    for (const [toolName, tool] of Object.entries(toolkit)) {\n      if (tool.render) {\n        unsubscribes.push(setToolUI(toolName, tool.render));\n      }\n    }\n\n    // Register tools with model context (exclude symbols)\n    const toolsWithoutRender = Object.entries(toolkit).reduce(\n      (acc, [name, tool]) => {\n        const { render, ...rest } = tool;\n        acc[name] = rest;\n        return acc;\n      },\n      {} as Record<string, Tool<any, any>>,\n    );\n\n    const modelContextProvider = {\n      getModelContext: () => ({\n        tools: toolsWithoutRender,\n      }),\n    };\n\n    unsubscribes.push(modelContext.register(modelContextProvider));\n\n    return () => {\n      unsubscribes.forEach((fn) => fn());\n    };\n  }, [toolkit, modelContext]);\n\n  const setToolUI = (toolName: string, render: any) => {\n    setState((prev) => {\n      return {\n        ...prev,\n        tools: {\n          ...prev.tools,\n          [toolName]: [...(prev.tools[toolName] ?? []), render],\n        },\n      };\n    });\n\n    return () => {\n      setState((prev) => {\n        return {\n          ...prev,\n          tools: {\n            ...prev.tools,\n            [toolName]: prev.tools[toolName]?.filter((r) => r !== render) ?? [],\n          },\n        };\n      });\n    };\n  };\n\n  return tapApi<ToolsApi>({\n    getState: () => state,\n    setToolUI,\n  });\n});\n"],"mappings":";AAAA,SAAS,UAAU,UAAU,iBAAiB;AAC9C,SAAS,cAAc;AACvB,SAAS,uBAAuB;AAKzB,IAAM,QAAQ,SAAS,CAAC,EAAE,QAAQ,MAA6B;AACpE,QAAM,CAAC,OAAO,QAAQ,IAAI,SAAqB,OAAO;AAAA,IACpD,OAAO,CAAC;AAAA,EACV,EAAE;AAEF,QAAM,eAAe,gBAAgB;AAErC,YAAU,MAAM;AACd,QAAI,CAAC,QAAS;AACd,UAAM,eAA+B,CAAC;AAGtC,eAAW,CAAC,UAAU,IAAI,KAAK,OAAO,QAAQ,OAAO,GAAG;AACtD,UAAI,KAAK,QAAQ;AACf,qBAAa,KAAK,UAAU,UAAU,KAAK,MAAM,CAAC;AAAA,MACpD;AAAA,IACF;AAGA,UAAM,qBAAqB,OAAO,QAAQ,OAAO,EAAE;AAAA,MACjD,CAAC,KAAK,CAAC,MAAM,IAAI,MAAM;AACrB,cAAM,EAAE,QAAQ,GAAG,KAAK,IAAI;AAC5B,YAAI,IAAI,IAAI;AACZ,eAAO;AAAA,MACT;AAAA,MACA,CAAC;AAAA,IACH;AAEA,UAAM,uBAAuB;AAAA,MAC3B,iBAAiB,OAAO;AAAA,QACtB,OAAO;AAAA,MACT;AAAA,IACF;AAEA,iBAAa,KAAK,aAAa,SAAS,oBAAoB,CAAC;AAE7D,WAAO,MAAM;AACX,mBAAa,QAAQ,CAAC,OAAO,GAAG,CAAC;AAAA,IACnC;AAAA,EACF,GAAG,CAAC,SAAS,YAAY,CAAC;AAE1B,QAAM,YAAY,CAAC,UAAkB,WAAgB;AACnD,aAAS,CAAC,SAAS;AACjB,aAAO;AAAA,QACL,GAAG;AAAA,QACH,OAAO;AAAA,UACL,GAAG,KAAK;AAAA,UACR,CAAC,QAAQ,GAAG,CAAC,GAAI,KAAK,MAAM,QAAQ,KAAK,CAAC,GAAI,MAAM;AAAA,QACtD;AAAA,MACF;AAAA,IACF,CAAC;AAED,WAAO,MAAM;AACX,eAAS,CAAC,SAAS;AACjB,eAAO;AAAA,UACL,GAAG;AAAA,UACH,OAAO;AAAA,YACL,GAAG,KAAK;AAAA,YACR,CAAC,QAAQ,GAAG,KAAK,MAAM,QAAQ,GAAG,OAAO,CAAC,MAAM,MAAM,MAAM,KAAK,CAAC;AAAA,UACpE;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAEA,SAAO,OAAiB;AAAA,IACtB,UAAU,MAAM;AAAA,IAChB;AAAA,EACF,CAAC;AACH,CAAC;","names":[]}